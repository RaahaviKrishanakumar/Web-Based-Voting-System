<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
  <meta charset="UTF-8">
  <title>Nominee Management - HR Panel</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
  <style>
    body { background-color: #f8f9fa; }
    .sidebar { width: 250px; min-height: 100vh; background: #212529; color: white; position: fixed; }
    .sidebar a { display: block; padding: 12px 20px; color: white; text-decoration: none; }
    .sidebar a:hover, .sidebar a.active { background: #343a40; }
    .content { margin-left: 250px; padding: 20px; }
    .card { border-radius: 12px; margin-bottom: 20px; }
    .nominee-img { width: 60px; height: 60px; object-fit: cover; border-radius: 6px; }
    .counter-valid { color: green; }
    .counter-invalid { color: red; }
  </style>
</head>
<body>

<!-- Sidebar -->
<div class="sidebar">
  <h3 class="text-center py-3">üëî HR Panel</h3>
  <a th:href="@{/admin/dashboard}"><i class="bi bi-speedometer2"></i> Dashboard</a>
  <a th:href="@{/hr/nominees}" class="active"><i class="bi bi-mic"></i> Nominee Management</a>
  <a th:href="@{/logout}"><i class="bi bi-box-arrow-right"></i> Logout</a>
</div>

<!-- Main Content -->
<div class="content">
  <h2 class="mb-4"><i class="bi bi-mic"></i> Nominee Management</h2>

  <!-- Pending Nominees -->
  <div class="card shadow p-4">
    <h5 class="mb-3">‚è≥ Pending Nominees</h5>
    <table class="table table-hover align-middle">
      <thead class="table-dark">
      <tr>
        <th>#</th>
        <th>Nominee</th>
        <th>Category</th>
        <th>Description</th>
        <th>Image</th>
        <th>Status</th>
        <th>Actions</th>
      </tr>
      </thead>
      <tbody>
      <tr th:if="${#lists.isEmpty(pendingNominees)}">
        <td colspan="7" class="text-center text-muted">No pending nominees</td>
      </tr>
      <tr th:each="nom, iterStat : ${pendingNominees}">
        <td th:text="${iterStat.index + 1}"></td>
        <td th:text="${nom.name}"></td>
        <td th:text="${nom.category.name}"></td>
        <td th:text="${nom.description}"></td>
        <td><img th:src="${nom.imagePath}" class="nominee-img"></td>
        <td><span class="badge bg-warning text-dark">Pending</span></td>
        <td>
          <!-- Approve -->
          <form th:action="@{'/hr/nominee/approve/' + ${nom.id}}" method="post" style="display:inline;">
            <button type="submit" class="btn btn-sm btn-success"><i class="bi bi-check2-circle"></i> Approve</button>
          </form>
          <!-- Reject -->
          <form th:action="@{'/hr/nominee/reject/' + ${nom.id}}" method="post" style="display:inline;">
            <button type="submit" class="btn btn-sm btn-danger"><i class="bi bi-x-circle"></i> Reject</button>
          </form>
          <!-- Delete -->
          <form th:action="@{'/hr/nominee/delete/' + ${nom.id}}" method="post" style="display:inline;">
            <button type="submit" class="btn btn-sm btn-outline-danger"><i class="bi bi-trash"></i> Delete</button>
          </form>
          <!-- Edit -->
          <button class="btn btn-sm btn-primary" data-bs-toggle="modal"
                  th:data-bs-target="'#editNomineeModal-' + ${nom.id}">
            <i class="bi bi-pencil-square"></i> Edit
          </button>
        </td>
      </tr>
      </tbody>
    </table>
  </div>

  <!-- Approved Nominees -->
  <div class="card shadow p-4">
    <h5 class="mb-3">‚úÖ Approved Nominees</h5>
    <table class="table table-hover align-middle">
      <thead class="table-success">
      <tr>
        <th>#</th>
        <th>Nominee</th>
        <th>Category</th>
        <th>Description</th>
        <th>Image</th>
        <th>Status</th>
      </tr>
      </thead>
      <tbody>
      <tr th:if="${#lists.isEmpty(approvedNominees)}">
        <td colspan="6" class="text-center text-muted">No approved nominees</td>
      </tr>
      <tr th:each="nom, iterStat : ${approvedNominees}">
        <td th:text="${iterStat.index + 1}"></td>
        <td th:text="${nom.name}"></td>
        <td th:text="${nom.category.name}"></td>
        <td th:text="${nom.description}"></td>
        <td><img th:src="${nom.imagePath}" class="nominee-img"></td>
        <td><span class="badge bg-success">Approved</span></td>
      </tr>
      </tbody>
    </table>
  </div>

  <!-- Rejected Nominees -->
  <div class="card shadow p-4">
    <h5 class="mb-3">‚ùå Rejected Nominees</h5>
    <table class="table table-hover align-middle">
      <thead class="table-danger">
      <tr>
        <th>#</th>
        <th>Nominee</th>
        <th>Category</th>
        <th>Description</th>
        <th>Image</th>
        <th>Status</th>
      </tr>
      </thead>
      <tbody>
      <tr th:if="${#lists.isEmpty(rejectedNominees)}">
        <td colspan="6" class="text-center text-muted">No rejected nominees</td>
      </tr>
      <tr th:each="nom, iterStat : ${rejectedNominees}">
        <td th:text="${iterStat.index + 1}"></td>
        <td th:text="${nom.name}"></td>
        <td th:text="${nom.category.name}"></td>
        <td th:text="${nom.description}"></td>
        <td><img th:src="${nom.imagePath}" class="nominee-img"></td>
        <td><span class="badge bg-danger">Rejected</span></td>
      </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- üîπ Edit Nominee Modal -->
<div th:each="nom : ${pendingNominees}"
     th:id="'editNomineeModal-' + ${nom.id}"
     class="modal fade" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <form th:action="@{'/hr/nominee/update/' + ${nom.id}}" method="post" enctype="multipart/form-data">
        <div class="modal-header">
          <h5 class="modal-title">Edit Nominee</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <input type="hidden" name="id" th:value="${nom.id}"/>

          <div class="mb-3 text-center">
            <img th:src="${nom.imagePath}" class="img-thumbnail"
                 style="width:120px; height:120px; object-fit:cover;">
          </div>

          <div class="mb-3">
            <label class="form-label">Name</label>
            <input type="text" class="form-control" name="name" th:value="${nom.name}" required>
          </div>

          <div class="mb-3">
            <label class="form-label">Description</label>
            <textarea class="form-control" name="description" rows="3"
                      minlength="10" maxlength="300"
                      placeholder="Enter 10‚Äì300 characters"
                      th:text="${nom.description}" required></textarea>
            <div class="form-text">
              <span th:id="'descCount-' + ${nom.id}">0</span>/300
            </div>
          </div>

          <div class="mb-3">
            <label class="form-label">Category</label>
            <select class="form-select" name="categoryId" required>
              <option th:each="cat : ${categories}"
                      th:value="${cat.id}"
                      th:text="${cat.name}"
                      th:selected="${cat.id == nom.category.id}">
              </option>
            </select>
          </div>

          <div class="mb-3">
            <label class="form-label">Change Image</label>
            <input type="file" name="imageFile" class="form-control" accept="image/*">
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary">Save changes</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    document.querySelectorAll("textarea[name='description']").forEach(function (ta) {
      const nomineeId = ta.form.querySelector("input[name='id']").value;
      const counter = document.getElementById("descCount-" + nomineeId);

      function updateCount() {
        counter.textContent = ta.value.length;
        if (ta.value.length < 10 || ta.value.length > 300) {
          counter.classList.remove("counter-valid");
          counter.classList.add("counter-invalid");
        } else {
          counter.classList.remove("counter-invalid");
          counter.classList.add("counter-valid");
        }
      }

      ta.addEventListener("input", updateCount);
      updateCount();
    });
  });
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
