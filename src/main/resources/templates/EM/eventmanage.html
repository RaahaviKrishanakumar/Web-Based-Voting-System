<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
  <meta charset="UTF-8">
  <title>Event Management - Admin Panel</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">

  <style>
    body { background-color: #f8f9fa; }
    .sidebar {
      width: 250px;
      min-height: 100vh;
      background: #212529;
      color: white;
      position: fixed;
      top: 0; left: 0;
    }
    .sidebar h3 { font-size: 1.3rem; }
    .sidebar a {
      display: block;
      padding: 12px 20px;
      color: white;
      text-decoration: none;
    }
    .sidebar a:hover,
    .sidebar a.active { background: #343a40; }
    .content { margin-left: 250px; padding: 20px; }
    .card { border-radius: 12px; margin-bottom: 30px; }
    .table img { border-radius: 6px; }
  </style>
</head>
<body>

<!-- Sidebar -->
<div class="sidebar">
  <h3 class="text-center py-3">ðŸŽµ EM Panel</h3>
  <a th:href="@{/admin/dashboard}"><i class="bi bi-speedometer2"></i> Dashboard</a>
</div>

<!-- Main Content -->
<div class="content">
  <h2 class="mb-4"><i class="bi bi-calendar-event"></i> Event Management</h2>

  <!-- Event Section -->
  <div class="card shadow p-4">
    <h5>Create Event</h5>
    <form class="row g-3" th:action="@{/admin/events/create}" method="post" th:object="${event}">
      <div class="col-md-6">
        <label class="form-label">Event Name</label>
        <input type="text" class="form-control" th:field="*{name}" placeholder="Music Awards 2025" required>
      </div>
      <div class="col-md-3">
        <label class="form-label">Date</label>
        <input type="date" class="form-control" th:field="*{eventDate}" required>
      </div>
      <div class="col-12">
        <label class="form-label">Description</label>
        <textarea class="form-control" th:field="*{description}" rows="3" placeholder="Enter event description..." required></textarea>
      </div>
      <div class="col-12">
        <button class="btn btn-success"><i class="bi bi-plus-circle"></i> Create Event</button>
      </div>
    </form>
    <hr>
    <h6>Existing Events</h6>
    <table class="table table-hover align-middle">
      <thead class="table-dark">
      <tr>
        <th>#</th>
        <th>Event Name</th>
        <th>Date</th>
        <th>Status</th>
        <th>Actions</th>
      </tr>
      </thead>
      <tbody>
      <tr th:if="${#lists.isEmpty(events)}">
        <td colspan="5" class="text-center text-muted">No events found</td>
      </tr>
      <tr th:each="ev, iterStat : ${events}">
        <td th:text="${iterStat.index + 1}"></td>
        <td th:text="${ev.name}"></td>
        <td th:text="${ev.eventDate}"></td>
        <td>
          <span th:if="${ev != null and ev.status != null and ev.status == 'ACTIVE'}" class="badge bg-success">Active</span>
          <span th:if="${ev != null and ev.status != null and ev.status == 'CLOSED'}" class="badge bg-secondary">Closed</span>
        </td>
        <td>
          <!-- End event button -->
          <form th:if="${ev != null and ev.status != null and ev.status == 'ACTIVE'}"
                th:action="@{'/admin/events/close/' + ${ev.id}}" method="post">
            <button class="btn btn-sm btn-danger mb-1"><i class="bi bi-x-circle"></i> End</button>
          </form>

          <!-- Edit form (only for ACTIVE events) -->
          <form th:if="${ev != null and ev.status != null and ev.status == 'ACTIVE'}"
                th:action="@{'/admin/events/update/' + ${ev.id}}" method="post" class="mt-1">
            <input type="text" name="name" th:value="${ev.name}" class="form-control form-control-sm mb-1" required>
            <input type="date" name="eventDate" th:value="${ev.eventDate}" class="form-control form-control-sm mb-1" required>
            <textarea name="description" class="form-control form-control-sm mb-1" rows="2"
                      th:text="${ev.description}"></textarea>
            <button class="btn btn-sm btn-warning w-100"><i class="bi bi-pencil"></i> Update</button>
          </form>
        </td>
      </tr>
      </tbody>
    </table>
  </div>

  <!-- Category Section -->
  <div class="card shadow p-4">
    <h5>Manage Categories</h5>
    <form class="row g-3" th:action="@{/admin/categories/create}" method="post" th:object="${category}">
      <div class="col-md-10">
        <label class="form-label">Category Name</label>
        <input type="text" class="form-control" th:field="*{name}" placeholder="Best Male Artist" required>
      </div>
      <div class="col-md-2 d-flex align-items-end">
        <button class="btn btn-primary w-100"><i class="bi bi-plus-circle"></i> Add</button>
      </div>
    </form>
    <hr>
    <h6>Category List</h6>
    <table class="table table-striped align-middle">
      <thead>
      <tr>
        <th>#</th>
        <th>Category Name</th>
        <th>Event</th>
        <th>Actions</th>
      </tr>
      </thead>
      <tbody>
      <tr th:if="${#lists.isEmpty(categories)}">
        <td colspan="4" class="text-center text-muted">No categories found</td>
      </tr>
      <tr th:each="cat, iterStat : ${categories}">
        <td th:text="${iterStat.index + 1}"></td>
        <td th:text="${cat.name}"></td>
        <td th:text="${cat.event.name}"></td>
        <td>
          <form th:action="@{'/admin/categories/delete/' + ${cat.id}}" method="post">
            <button class="btn btn-sm btn-danger"><i class="bi bi-trash"></i></button>
          </form>
        </td>
      </tr>
      </tbody>
    </table>
  </div>

  <!-- Nominee Section -->
  <div class="card shadow p-4">
    <h5>Manage Nominees</h5>
    <form class="row g-3" th:action="@{/admin/nominees/create}" method="post" enctype="multipart/form-data" th:object="${nominee}">
      <div class="col-md-4">
        <label class="form-label">Nominee Name</label>
        <input type="text" class="form-control" th:field="*{name}" placeholder="Artist Name" required>
      </div>
      <div class="col-md-4">
        <label class="form-label">Category</label>
        <select class="form-select" th:field="*{category}" required>
          <option value="">-- Select Category --</option>
          <option th:each="cat : ${categories}" th:value="${cat.id}" th:text="${cat.name}"></option>
        </select>
      </div>
      <div class="col-md-4">
        <label class="form-label">Upload Image</label>
        <input type="file" class="form-control" name="nomineeImage" accept="image/*" required>
      </div>
      <div class="col-12">
        <label class="form-label">Description</label>
        <textarea class="form-control" th:field="*{description}" rows="2" placeholder="Short description..."></textarea>
      </div>
      <div class="col-12">
        <button class="btn btn-success"><i class="bi bi-plus-circle"></i> Add Nominee</button>
      </div>
    </form>
    <hr>
    <h6>Nominee List</h6>
    <table class="table table-bordered align-middle">
      <thead class="table-light">
      <tr>
        <th>#</th>
        <th>Nominee</th>
        <th>Category</th>
        <th>Image</th>
        <th>Status</th>
        <th>Actions</th>
      </tr>
      </thead>
      <tbody>
      <tr th:if="${#lists.isEmpty(nominees)}">
        <td colspan="6" class="text-center text-muted">No nominees found</td>
      </tr>
      <tr th:each="nom, iterStat : ${nominees}">
        <td th:text="${iterStat.index + 1}"></td>
        <td th:text="${nom.name}"></td>
        <td th:text="${nom.category.name}"></td>
        <td><img th:src="@{${nom.imagePath}}" width="60"></td>
        <td th:text="${nom.status}"></td>
        <td>
          <form th:action="@{'/admin/nominees/delete/' + ${nom.id}}" method="post">
            <button class="btn btn-sm btn-danger"><i class="bi bi-trash"></i></button>
          </form>
        </td>
      </tr>
      </tbody>
    </table>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
